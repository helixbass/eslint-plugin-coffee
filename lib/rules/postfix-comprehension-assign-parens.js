// Generated by CoffeeScript 2.5.0
(function() {
  /**
   * @fileoverview Enforces that an assignment as the body of a postfix comprehension is wrapped in parens.
   * @author Julian Rosse
   */
  'use strict';
  var isSingleAssignmentBlock;

  //------------------------------------------------------------------------------
  // Helpers
  //------------------------------------------------------------------------------
  isSingleAssignmentBlock = function(block) {
    var expression, singleStatement;
    if ((block != null ? block.type : void 0) !== 'BlockStatement') {
      return false;
    }
    if (block.body.length !== 1) {
      return false;
    }
    [singleStatement] = block.body;
    if (singleStatement.type !== 'ExpressionStatement') {
      return false;
    }
    ({expression} = singleStatement);
    if (expression.type !== 'AssignmentExpression') {
      return false;
    }
    return expression;
  };

  //------------------------------------------------------------------------------
  // Rule Definition
  //------------------------------------------------------------------------------
  module.exports = {
    meta: {
      docs: {
        description: 'enforce parentheses around an assignment as the body of a postfix comprehension',
        category: 'Stylistic Issues',
        recommended: false
      },
      // url: 'https://eslint.org/docs/rules/object-curly-spacing'
      schema: [],
      fixable: 'code',
      messages: {
        missingParens: 'Add parentheses around the assignment to avoid confusion about the comprehensionâ€™s structure.'
      }
    },
    create: function(context) {
      var isWrappedInParens, sourceCode;
      sourceCode = context.getSourceCode();
      isWrappedInParens = function(expression) {
        var nextToken;
        nextToken = sourceCode.getTokenAfter(expression);
        return nextToken.value === ')';
      };
      return {
        //--------------------------------------------------------------------------
        // Public
        //--------------------------------------------------------------------------
        For: function({postfix, body}) {
          var assignment;
          if (!postfix) {
            return;
          }
          if (!(assignment = isSingleAssignmentBlock(body))) {
            return;
          }
          if (isWrappedInParens(assignment)) {
            return;
          }
          return context.report({
            node: assignment,
            messageId: 'missingParens',
            fix: function(fixer) {
              return fixer.replaceText(assignment, `(${sourceCode.getText(assignment)})`);
            }
          });
        }
      };
    }
  };

}).call(this);
